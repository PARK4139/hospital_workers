# 🏗️ 프로젝트 아키텍처 설계

## 📋 개요
HealBase 병원 직원 관리 시스템의 전체 아키텍처 설계 문서

## 🎯 설계 달성 목표
- **SEO 성능 우수**: 검색 엔진 최적화를 통한 높은 검색 노출도
- **멀티플랫폼 지원**: PC/스마트폰/웹 환경에서 일관된 사용자 경험
- **유지보수 용이성**: 모듈화된 구조와 명확한 책임 분리
- **뛰어난 UX**: 직관적이고 반응성 있는 사용자 인터페이스

## 🏛️ 적용 디자인패턴 및 아키텍처 정의

### 1. DDD (Domain-Driven Design) 아키텍처
- **도메인 중심 설계**: 병원 직원 관리 도메인 중심으로 서비스 구성
- **바운디드 컨텍스트**: 인증, 병원정보, 위치가이드 등 도메인별 분리
- **도메인 모델**: 각 서비스별 독립적인 도메인 모델 구현

### 2. MSA (Microservice Architecture) 적용
- **서비스 분리**: 각 도메인별 독립적인 마이크로서비스 구성
- **API Gateway**: nginx를 통한 서비스 라우팅
- **서비스 간 통신**: HTTP REST API 기반 통신

### 3. Docker Container 구성
- **MSA 단위 컨테이너**: 각 마이크로서비스별 독립적인 컨테이너
- **개발/운영 환경 분리**: docker-compose.dev.yml, docker-compose.prod.yml
- **서비스 격리**: 각 서비스별 독립적인 리소스 관리

## 🏢 서버 구조 설계

### 1. Vercel/Page 서버 (Next.js + TypeScript + Tailwind CSS + Zustand + NextAuth.js)
- **역할**: 프론트엔드 페이지 서버
- **기술 스택**: Next.js, TypeScript, Tailwind CSS, Zustand, NextAuth.js
- **배포**: Vercel 플랫폼
- **기능**: 사용자 인터페이스, 페이지 라우팅, 상태 관리, 인증
- **모바일**: React Native OAuth 지원

### 2. AWS EC2/API 서버 (FastAPI)
- **역할**: 백엔드 API 서버
- **기술 스택**: FastAPI, Python 3.13+
- **배포**: AWS EC2 인스턴스
- **기능**: 비즈니스 로직, API 엔드포인트

### 3. AWS EC2/DB 서버 (PostgreSQL)
- **역할**: 데이터베이스 서버
- **기술 스택**: PostgreSQL
- **배포**: AWS EC2 인스턴스
- **기능**: 데이터 저장, 최소 테이블 구조 (Database 테이블 개수는 최소화하여 운영)

## 🔧 환경 구성 요소 설계

### 1. 서버 운영 환경 (AWS EC2)
- **인스턴스 타입**: t3.medium 이상
- **운영체제**: Ubuntu 22.04 LTS
- **보안 그룹**: HTTP(80), HTTPS(443), SSH(22) 포트 개방

### 2. Docker 환경
- **개발 환경**: docker-compose.dev.yml
- **운영 환경**: docker-compose.prod.yml
- **컨테이너 오케스트레이션**: Docker Compose

### 3. Python 가상환경
- **Python 버전**: 3.13 이상
- **패키지 관리**: uv (uv.lock, pyproject.toml)
- **의존성 관리**: pyproject.toml 기반

## 🌐 URL 패턴 설계 (page 서버, api 서버 url 라우터에 적용)

### API 서버 URL 패턴
```
heal_base_hospital_worker/v1/api/ensure/login/                     # 로그인 API
```

### Page 서버 URL 패턴
```
heal_base_hospital_worker/v1/page/ensure/login/                     # 로그인 (메인화면)
heal_base_hospital_worker/v1/page/ensure/login-guide/               # 로그인 (가이드)
heal_base_hospital_worker/v1/page/ensure/login-via-google            # 로그인 (구글)
heal_base_hospital_worker/v1/page/ensure/signup/                    # 회원가입
heal_base_hospital_worker/v1/page/ensure/signup-form-submit/        # 회원가입 폼 작성 및 제출
heal_base_hospital_worker/v1/page/ensure/signup-complete/           # 회원가입 완료 페이지
heal_base_hospital_worker/v1/page/ensure/logined/and/hospital-location-guided/{실}  # 실별위치가이드 + 광고
```

## 📁 트리 구조 설계

```
business_with_ai/
├── prompts/                                    # AI 기반 코드생성 명령용 프롬프트 모음
├── services/{MSA service name}/                # MSA 레벨의 서비스하위 요소 집합
│   ├── page_server/                           # frontend 관련 요소 (web 소스코드) 의 집합
│   │   ├── app/                              # Next.js App Router
│   │   ├── components/                       # React 컴포넌트
│   │   ├── lib/                              # 유틸리티 함수
│   │   ├── store/                            # Zustand 상태 관리
│   │   ├── auth/                             # NextAuth.js 설정
│   │   ├── public/                           # 정적 파일
│   │   ├── package.json                      # Node.js 의존성
│   │   ├── next.config.js                    # Next.js 설정
│   │   ├── tailwind.config.js                # Tailwind CSS 설정
│   │   └── tsconfig.json                     # TypeScript 설정
│   ├── api_server/                           # api server 관련 요소 (api 라우터 소스코드, api 컨테이너, 등)의 집합
│   │   ├── src/                              # FastAPI 소스코드
│   │   ├── tests/                            # API 테스트
│   │   ├── pyproject.toml                    # Python 의존성
│   │   ├── uv.lock                           # uv 잠금 파일
│   │   └── Dockerfile                        # API 컨테이너
│   ├── db_server/                            # db server 관련 요소 (db 컨테이너, 등)의 집합
│   │   ├── migrations/                       # 데이터베이스 마이그레이션
│   │   ├── seeds/                            # 초기 데이터
│   │   └── docker-compose.yml                # DB 컨테이너
│   └── shared/                               # 공통 모듈
├── scripts/                                   # 서비스 자동화용 스크립트 (ensure_ prefix 패턴적용)
├── tests/                                     # 테스트용 스크립트 (test_ prefix 패턴적용)
├── logs/                                      # 프로그램 실행의 결과를 저장, 서비스 운영에서 발생된 로그 저장
└── docs/                        # 비즈니스 기획서
```

## 🔄 마이그레이션 계획

### Phase 1: 구조 재구성
1. 현재 구조를 새로운 트리 구조로 이동
2. page_server, api_server, db_server 분리
3. URL 패턴 적용

### Phase 2: 환경 구성
1. AWS EC2 환경 설정
2. Vercel 배포 환경 구성
3. Docker 환경 최적화

### Phase 3: 서비스 분리
1. Next.js 프론트엔드 서비스 분리
2. FastAPI 백엔드 서비스 분리
3. PostgreSQL 데이터베이스 서비스 분리

## 📊 현재 vs 목표 구조 비교

### 현재 구조
```
services/hospital_workers/
├── auth-service/          # 인증 서비스
├── api-service/          # API 서비스
├── frontend/             # 프론트엔드
├── nginx/                # 프록시
└── user-db/              # 데이터베이스
```

### 목표 구조
```
services/hospital_workers/
├── page_server/          # Next.js + TypeScript + Tailwind CSS + Zustand + NextAuth.js
├── api_server/           # FastAPI + Python 3.13+ + uv
├── db_server/            # PostgreSQL (최소 테이블 구조)
└── shared/               # 공통 모듈
```
